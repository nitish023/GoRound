<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Goal Tracker</title>
  <script
    src="https://sdk.openui5.org/resources/sap-ui-core.js"
    id="sap-ui-bootstrap"
    data-sap-ui-theme="sap_horizon"
    data-sap-ui-libs="sap.m"
    data-sap-ui-xx-bindingSyntax="complex"
    data-sap-ui-resourceroots='{"goal.ui": "./"}'>
  </script>
  <script>
    sap.ui.getCore().attachInit(function () {
      new sap.m.App({
        pages: [
          new sap.m.Page({
            title: "Goal Creator",
            content: [
              new sap.m.Input({ placeholder: "Goal Title", width: "100%", id: "goalTitle" }),
              new sap.m.Input({ placeholder: "Target Amount", type: "Number", id: "targetAmount" }),
              new sap.m.Button({
                                text: "Create Goal",
                press: async function () {
                    const title = sap.ui.getCore().byId("goalTitle").getValue();
                    const amount = sap.ui.getCore().byId("targetAmount").getValue();

                    const response = await fetch('/odata/v4/GoalService/createGoal', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                        title,
                        targetAmount: parseFloat(amount)
                        })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        alert("Goal created! ID: " + result.value);
                    } else {
                        const error = await response.json();
                        alert("Error creating goal: " + error.error.message);
                    }
                }
              }),
              new sap.m.HBox({
                items: [
                  new sap.m.Input({ placeholder: "Goal ID", id: "goalId" }),
                  new sap.m.Input({ placeholder: "Deposit Amount", type: "Number", id: "depositAmount" }),
                  new sap.m.Button({
                    text: "Deposit",
                    press: async function () {
                      const goalID = sap.ui.getCore().byId("goalId").getValue();
                      const amount = sap.ui.getCore().byId("depositAmount").getValue();
                      const response = await fetch('/odata/v4/GoalService/depositToGoal', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ goalID, amount: parseFloat(amount) })
                      });
                      if (response.ok) alert("Deposited successfully!");
                      else alert("Deposit failed.");
                    }
                  })
                ]
              })
            ]
          })
        ]
      }).placeAt("content");
    });
  </script>
</head>
<body class="sapUiBody" id="content"></body>
</html>
